---
layout: post
title: Beaglebone change I2C speed to 400 KHz
date: '2014-12-25T22:22:00.000-03:00'
author: Murilo Pontes
tags:
- device tree
- I2C
- 400khz
- BeagleBone Black
- dtb
- 100khz
- dtc
- dts
modified_time: '2015-02-09T17:00:08.132-03:00'
thumbnail: http://2.bp.blogspot.com/-56N5cJjXxUo/VLpULjTTrYI/AAAAAAAAukM/5QagGZLTp4U/s72-c/i2c_logo2.gif
blogger_id: tag:blogger.com,1999:blog-3047384083282566923.post-7232952381903051889
blogger_orig_url: http://dronespersonalizados.blogspot.com/2014/12/beaglebone-mudar-i2c-de-100khz-para.html
---

A velocidade padrão das capes no i2c é 100KHz, mas quero mudar para 400KHz<br />Testado na Beaglebone Black rev. C com Debian 7.5 e 7.7<br /><br /><br /><a name='more'></a><br /><br />#tirar o backup do device tree<br />cp /boot/uboot/dtbs/am335x-boneblack.dtb /boot/uboot/dtbs/am335x-boneblack.dtb-backup<br /><br />#converte device tree binário para texto<br />dtc -I dtb -O dts -o /boot/uboot/dtbs/am335x-boneblack.dts /boot/uboot/dtbs/am335x-boneblack.dtb<br /><br />#editar a clock-frequency para 400000<br />nano /boot/uboot/dtbs/am335x-boneblack.dts<br /><br />&nbsp; &nbsp; &nbsp; i2c@4819c000 {<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; compatible = "ti,omap4-i2c";<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; #address-cells = <0x1>;<!--0x1--><!--0x1--><!--0x1--><!--0x1--><!--0x1--><!--0x1--><!--0x1--><!--0x1--><!--0x1--></0x1><br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; #size-cells = <0x0>;<!--0x0--><!--0x0--><!--0x0--><!--0x0--><!--0x0--><!--0x0--><!--0x0--><!--0x0--><!--0x0--></0x0><br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ti,hwmods = "i2c3";<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; reg = <0x4819c000 0x1000="">;<!--0x4819c000--><!--0x4819c000--><!--0x4819c000--><!--0x4819c000--><!--0x4819c000--><!--0x4819c000--><!--0x4819c000--><!--0x4819c000--><!--0x4819c000--></0x4819c000><br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; interrupts = <0x1e>;<!--0x1e--><!--0x1e--><!--0x1e--><!--0x1e--><!--0x1e--><!--0x1e--><!--0x1e--><!--0x1e--><!--0x1e--></0x1e><br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; status = "okay";<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; pinctrl-names = "default";<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; pinctrl-0 = <0x7>;<!--0x7--><!--0x7--><!--0x7--><!--0x7--><!--0x7--><!--0x7--><!--0x7--><!--0x7--><!--0x7--></0x7><br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; #clock-frequency = <0x186a0>; //100KHz<!--0x186a0--><!--0x186a0--><!--0x186a0--><!--0x186a0--><!--0x186a0--><!--0x186a0--><!--0x186a0--><!--0x186a0--><!--0x186a0--></0x186a0><br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; clock-frequency = <400000>;<!--400000--><!--400000--><!--400000--><!--400000--><!--400000--><!--400000--><!--400000--><!--400000--><!--400000--></400000><br /><br />#converte device tree de texto para binário<br />dtc -I dts -O dtb -o /boot/uboot/dtbs/am335x-boneblack.dtb /boot/uboot/dtbs/am335x-boneblack.dts<br /><br />reiniciar, e procure no log, deve estar em 400KHz agora.<br /><br />[ &nbsp; &nbsp;0.131766] omap_i2c 44e0b000.i2c: bus 0 rev0.11 at 400 kHz<br />[ &nbsp; &nbsp;0.132684] input: tps65217_pwr_but as /devices/ocp.3/44e0b000.i2c/i2c-0/0-0024/input/input0<br />[ &nbsp; &nbsp;0.140854] omap_i2c 44e0b000.i2c: unable to select pin group<br /><b>[ &nbsp; &nbsp;0.141335] omap_i2c 4819c000.i2c: bus 1 rev0.11 at 400 kHz</b><br /><br /><br /><div class="separator" style="clear: both; text-align: center;"><a href="http://en.wikipedia.org/wiki/I%C2%B2C" target="_blank"><img border="0" src="http://2.bp.blogspot.com/-56N5cJjXxUo/VLpULjTTrYI/AAAAAAAAukM/5QagGZLTp4U/s1600/i2c_logo2.gif" /></a></div><br />Desativar o i2c das CAPES<br /><br />#converte de binário para texto<br />dtc -I dtb -O dts -o am335x-boneblack.dts am335x-boneblack.dtb<br /><br />#mudar de okay para disabled<br />&nbsp;status = "okay";<br /><br />&nbsp;status = "disabled";<br /><br />#converte de texto para binário<br />dtc -I dts -O dtb -o am335x-boneblack.dtb &nbsp;am335x-boneblack.dts<br /><br /><br /><br /><br />