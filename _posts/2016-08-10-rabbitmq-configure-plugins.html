---
layout: post
title: 'RabbitMQ server configure '
date: '2016-08-10T01:58:00.000-03:00'
author: Murilo Pontes
tags:
- MQTT
modified_time: '2016-08-29T00:14:41.797-03:00'
blogger_id: tag:blogger.com,1999:blog-3047384083282566923.post-5177643508810132504
blogger_orig_url: http://dronespersonalizados.blogspot.com/2016/08/rabbitmq-configure-plugins.html
---

<pre><br /># enable plugins and restart<br />rabbitmq-plugins enable rabbitmq_management<br />rabbitmq-plugins enable rabbitmq_mqtt<br />rabbitmq-plugins enable rabbitmq_web_stomp<br />rabbitmq-plugins enable rabbitmq_shovel<br />rabbitmq-plugins enable rabbitmq_management_visualiser <br />rabbitmq-plugins enable rabbitmq_recent_history_exchange <br />rabbitmq-plugins enable rabbitmq_top <br />rabbitmq-plugins enable rabbitmq_tracing<br /><br /># install and enable mqtt over websockets<br />cd /usr/lib/rabbitmq/lib/rabbitmq_server-3.6.5/plugins<br />wget http://www.rabbitmq.com/community-plugins/v3.6.x/rabbitmq_web_mqtt-3.6.x-3b6a09bb.ez<br /> rabbitmq-plugins enable rabbitmq_web_mqtt<br /><br />/etc/init.d/rabbitmq-server restart<br /><br />#change default passwrd<br />rabbitmqctl change_password guest s0m3p4ssw0rd<br /><br />#configure new user<br />rabbitmqctl add_user newadmin s0m3p4ssw0rd<br />rabbitmqctl set_user_tags newadmin administrator<br />rabbitmqctl set_permissions -p / newadmin ".*" ".*" ".*"<br /><br /><br /></pre> Generate SSL/TLS chain <pre></pre>  Edit /etc/rabbitmq/rabbitmq.config <pre><br />[<br /> {rabbit,<br />   {ssl_listeners, [5671]},<br />    {ssl_options, [<br />     {cacertfile,           "/opt/rabbitmq-ssl/testca/cacert.pem"},<br />     {certfile,             "/opt/rabbitmq-ssl/server/cert.pem"},<br />     {keyfile,              "/opt/rabbitmq-ssl/server/key.pem"},<br />     {verify,               verify_peer},<br />     {fail_if_no_peer_cert, false}]}<br />  ]},<br /> {rabbitmq_mqtt,<br />    {default_user, <<"guest">>},<br />    {default_pass, <<"guest">>},<br />    {allow_anonymous, true},<br />    {tcp_listeners, [1883]},<br />    {ssl_listeners, [8883]}<br />  ]},<br />].<br /></pre> Restart server <pre><br />/etc/init.d/rabbitmq-server restart<br /><br />#Test TLS<br />openssl s_client -connect 127.0.0.1:5671 -tls1<br /><br /># Test MQTT<br />mosquitto_sub -h localhost -v -t '#'<br />mosquitto_pub -h localhost -t 'test' -m 'msg'<br /><br /># Test MQTT with TLS<br />mosquitto_sub -h localhost -p 8883 -v -t '#' \<br /> --key /opt/rabbitmq-ssl/client/key.pem \<br /> --cert /opt/rabbitmq-ssl/client/cert.pem \<br /> --cafile /opt/rabbitmq-ssl/testca/cacert.pem<br />mosquitto_pub -h localhost -p 8883 -t 'test' -m 'msg' \<br /> --key /opt/rabbitmq-ssl/client/key.pem \<br /> --cert /opt/rabbitmq-ssl/client/cert.pem \<br /> --cafile /opt/rabbitmq-ssl/testca/cacert.pem<br /><br /><br /></pre>